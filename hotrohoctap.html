<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C3 | Chatbot AI ƒêa NƒÉng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Calibri', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .typing-dots::after {
            content: '...';
            animation: typing 1.5s infinite;
        }
        
        @keyframes typing {
            0% { content: '.'; }
            33% { content: '..'; }
            66% { content: '...'; }
        }
        
        .user-message {
            align-self: flex-end;
            background-color: #4f46e5;
            border-radius: 1rem;
            max-width: 80%;
            margin-left: auto;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        .bot-message {
            align-self: flex-start;
            background-color: #1e293b;
            border-radius: 1rem;
            max-width: 80%;
            margin-right: auto;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        .message-content {
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        
        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .suggestion-chip {
            background-color: #4f46e5;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }
        
        .suggestion-chip:hover {
            background-color: #4338ca;
        }
        
        .university-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .university-table th, .university-table td {
            padding: 0.5rem;
            border: 1px solid #334155;
            text-align: left;
            font-size: 0.9rem;
        }
        
        .university-table th {
            background-color: #1e293b;
            font-weight: 600;
        }
        
        .university-table tr:nth-child(even) {
            background-color: #1a2332;
        }
        
        .chat-item {
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .chat-item:hover {
            background-color: #334155;
        }
        
        .chat-item.active {
            background-color: #4f46e5;
        }
        
        .typing-indicator {
            background-color: #1e293b;
            border-radius: 1rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            max-width: 80%;
            margin-right: auto;
        }
    </style>
</head>
<body class="h-screen flex flex-col bg-gray-900 text-white">
    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <div class="w-64 bg-gray-800 shadow-lg border-r border-gray-700 flex flex-col h-full">
            <div class="p-3">
                <button id="new-chat-btn" class="w-10 h-10 flex items-center justify-center bg-indigo-600 hover:bg-indigo-700 text-white rounded-md transition">
                    <i class="fa-solid fa-file-circle-plus"></i>
                </button>
            </div>
            <div id="chat-history" class="flex-1 overflow-y-auto hide-scrollbar p-2">
                <div class="text-center p-4 text-gray-400">
                    Ch∆∞a c√≥ cu·ªôc tr√≤ chuy·ªán n√†o
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col h-full overflow-hidden">
            <header class="p-4 border-b border-gray-700 bg-gray-800">
                <h1 class="text-xl font-semibold text-left">C3 | Chatbot AI ƒêa NƒÉng</h1>
            </header>
            
            <div id="chat-container" class="flex-1 overflow-y-auto hide-scrollbar p-4 bg-gray-900 flex flex-col gap-3">
                <div id="chat-messages" class="flex flex-col gap-3 mx-auto max-w-3xl w-full">
                    <div class="bot-message">
                        <div class="message-content">
                            Xin ch√†o! T√¥i l√† Chatbot AI ƒêa NƒÉng. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n t√¨m hi·ªÉu v·ªÅ c√°c tr∆∞·ªùng ƒë·∫°i h·ªçc v√† nhi·ªÅu ch·ªß ƒë·ªÅ kh√°c. B·∫°n c·∫ßn h·ªó tr·ª£ g√¨?
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="typing-indicator" class="hidden max-w-3xl mx-auto">
                <div class="typing-indicator">
                    <span class="typing-dots">AI ƒëang suy nghƒ©, vui l√≤ng ƒë·ª£i gi√¢y l√°t</span>
                </div>
            </div>

            <div class="p-4 border-t border-gray-700 bg-gray-800">
                <div class="max-w-3xl mx-auto">
                    <div id="suggestions" class="suggestion-chips mb-2">
                        <div class="suggestion-chip" data-query="G·ª£i √Ω tr∆∞·ªùng ƒë·∫°i h·ªçc">üéì ƒê·∫°i h·ªçc</div>
                        <div class="suggestion-chip" data-query="Tr∆∞·ªùng ·ªü H√† N·ªôi">üìç H√† N·ªôi</div>
                        <div class="suggestion-chip" data-query="Tr∆∞·ªùng ·ªü TP.HCM">üìç TP.HCM</div>
                        <div class="suggestion-chip" data-query="Tr∆∞·ªùng c√¥ng l·∫≠p">üèõÔ∏è C√¥ng l·∫≠p</div>
                    </div>
                    <form id="chat-form" class="relative">
                        <textarea 
                            id="message-input" 
                            class="w-full p-4 rounded-lg border border-gray-600 bg-gray-700 resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white"
                            placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n ·ªü ƒë√¢y..."
                            rows="1"
                        ></textarea>
                        <button type="submit" class="absolute right-2 bottom-2 bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-md">
                            <i class="fa-solid fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Danh s√°ch c√°c tr∆∞·ªùng ƒë·∫°i h·ªçc Vi·ªát Nam
        const universities = [
            { name: "ƒê·∫°i h·ªçc Qu·ªëc gia H√† N·ªôi", code: "QHQ", area: "H√† N·ªôi", type: "C√¥ng l·∫≠p", rank: "ƒê·∫°i tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc Qu·ªëc gia TP.HCM", code: "QSC", area: "TP.HCM", type: "C√¥ng l·∫≠p", rank: "ƒê·∫°i tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc B√°ch khoa H√† N·ªôi", code: "BKA", area: "H√† N·ªôi", type: "C√¥ng l·∫≠p", rank: "ƒê·∫°i tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc Kinh t·∫ø Qu·ªëc d√¢n", code: "KTA", area: "H√† N·ªôi", type: "C√¥ng l·∫≠p", rank: "ƒê·∫°i tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc Ngo·∫°i th∆∞∆°ng", code: "NTH", area: "H√† N·ªôi", type: "C√¥ng l·∫≠p", rank: "ƒê·∫°i tr·ªçng ƒëi·ªÉm" },
            { name: "H·ªçc vi·ªán T√†i ch√≠nh", code: "HTC", area: "H√† N·ªôi", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc Y H√† N·ªôi", code: "YHB", area: "H√† N·ªôi", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc S∆∞ ph·∫°m H√† N·ªôi", code: "SPH", area: "H√† N·ªôi", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc B√°ch khoa TP.HCM", code: "BKS", area: "TP.HCM", type: "C√¥ng l·∫≠p", rank: "ƒê·∫°i tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc Kinh t·∫ø TP.HCM", code: "KTS", area: "TP.HCM", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc S∆∞ ph·∫°m TP.HCM", code: "SPS", area: "TP.HCM", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc Y D∆∞·ª£c TP.HCM", code: "YDS", area: "TP.HCM", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc C·∫ßn Th∆°", code: "TCT", area: "Mi·ªÅn T√¢y", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc ƒê√† N·∫µng", code: "DDN", area: "Mi·ªÅn Trung", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc Hu·∫ø", code: "DHT", area: "Mi·ªÅn Trung", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc FPT", code: "FPT", area: "Nhi·ªÅu c∆° s·ªü", type: "T∆∞ th·ª•c", rank: "T·ªëp ƒë·∫ßu t∆∞ th·ª•c" },
            { name: "ƒê·∫°i h·ªçc RMIT", code: "RMI", area: "TP.HCM/H√† N·ªôi", type: "Qu·ªëc t·∫ø", rank: "Qu·ªëc t·∫ø" },
            { name: "ƒê·∫°i h·ªçc T√¥n ƒê·ª©c Th·∫Øng", code: "DTT", area: "TP.HCM", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" },
            { name: "H·ªçc vi·ªán B∆∞u ch√≠nh Vi·ªÖn th√¥ng", code: "BVN", area: "H√† N·ªôi/TP.HCM", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" },
            { name: "ƒê·∫°i h·ªçc Giao th√¥ng V·∫≠n t·∫£i", code: "GTA", area: "H√† N·ªôi/TP.HCM", type: "C√¥ng l·∫≠p", rank: "Tr·ªçng ƒëi·ªÉm" }
        ];

        // C√°c bi·∫øn to√†n c·ª•c
        const chatContainer = document.getElementById('chat-container');
        const chatMessages = document.getElementById('chat-messages');
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const newChatBtn = document.getElementById('new-chat-btn');
        const chatHistory = document.getElementById('chat-history');
        const typingIndicator = document.getElementById('typing-indicator');
        const suggestionChips = document.querySelectorAll('.suggestion-chip');

        let chats = [];
        let currentChatId = null;
        let isSending = false;

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        function initApp() {
            loadChats();
            setupEventListeners();
            setupTextareaAutoResize();

            if (chats.length === 0) {
                createNewChat();
            } else {
                loadChat(chats[0].id);
            }
        }

        // Thi·∫øt l·∫≠p event listeners
        function setupEventListeners() {
            chatForm.addEventListener('submit', handleSubmit);
            newChatBtn.addEventListener('click', createNewChat);
            
            // Suggestion chips
            suggestionChips.forEach(chip => {
                chip.addEventListener('click', () => {
                    const query = chip.getAttribute('data-query');
                    messageInput.value = query;
                    handleSubmit(new Event('submit'));
                });
            });

            // X·ª≠ l√Ω ph√≠m t·∫Øt
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    if (messageInput.value.trim() !== '') {
                        handleSubmit(e);
                    }
                }
            });
            
            // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu cao textarea
            messageInput.addEventListener('input', autoResizeTextarea);
        }

        // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu cao textarea
        function autoResizeTextarea() {
            messageInput.style.height = 'auto';
            messageInput.style.height = (messageInput.scrollHeight) + 'px';
        }

        // X·ª≠ l√Ω g·ª≠i tin nh·∫Øn
        function handleSubmit(e) {
            e.preventDefault();
            const userMessage = messageInput.value.trim();
            if (!userMessage || isSending) return;

            if (!currentChatId) {
                createNewChat();
            }

            const currentChat = chats.find(chat => chat.id === currentChatId);
            if (!currentChat) {
                console.error("Kh√¥ng t√¨m th·∫•y cu·ªôc tr√≤ chuy·ªán hi·ªán t·∫°i!");
                return;
            }

            isSending = true;
            addMessageToUI("user", userMessage);
            
            currentChat.messages.push({ 
                role: "user", 
                content: userMessage,
                timestamp: new Date().toISOString()
            });

            saveChats();
            updateChatTitle(currentChat);

            messageInput.value = "";
            autoResizeTextarea();
            typingIndicator.classList.remove("hidden");

            // Gi·∫£ l·∫≠p th·ªùi gian ph·∫£n h·ªìi
            setTimeout(() => {
                try {
                    const response = generateResponse(userMessage);
                    addMessageToUI("assistant", response);
                    
                    currentChat.messages.push({ 
                        role: "assistant", 
                        content: response,
                        timestamp: new Date().toISOString()
                    });
                    
                    saveChats();
                } catch (error) {
                    console.error("L·ªói: ", error);
                    addMessageToUI("assistant", "Xin l·ªói, ƒë√£ x·∫£y ra l·ªói. Vui l√≤ng th·ª≠ l·∫°i!");
                } finally {
                    isSending = false;
                    typingIndicator.classList.add("hidden");
                    scrollToBottom();
                }
            }, 1000 + Math.random() * 1000);
        }

        // Th√™m tin nh·∫Øn v√†o giao di·ªán
        function addMessageToUI(role, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = role === 'user' ? 'user-message' : 'bot-message';
            
            const formattedContent = formatMessage(content);
            messageDiv.innerHTML = `<div class="message-content">${formattedContent}</div>`;
            
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        // ƒê·ªãnh d·∫°ng tin nh·∫Øn
        function formatMessage(content) {
            if (!content) return '';
            
            // X·ª≠ l√Ω b·∫£ng ƒë·∫°i h·ªçc
            if (content.includes('| T√™n tr∆∞·ªùng |')) {
                return content.replace(/\| T√™n tr∆∞·ªùng \| M√£ tr∆∞·ªùng \| Khu v·ª±c \| Lo·∫°i h√¨nh \| X·∫øp h·∫°ng \|\n\|[-|]+\|\n([\s\S]*)/, 
                    (match, rows) => {
                        const tableRows = rows.trim().split('\n');
                        let tableHTML = `
                            <div class="overflow-x-auto">
                                <table class="university-table">
                                    <thead>
                                        <tr>
                                            <th>T√™n tr∆∞·ªùng</th>
                                            <th>M√£ tr∆∞·ªùng</th>
                                            <th>Khu v·ª±c</th>
                                            <th>Lo·∫°i h√¨nh</th>
                                            <th>X·∫øp h·∫°ng</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                        `;
                        
                        tableRows.forEach(row => {
                            const cells = row.split('|').filter(cell => cell.trim() !== '');
                            if (cells.length === 5) {
                                tableHTML += `
                                    <tr>
                                        <td>${cells[0].trim()}</td>
                                        <td>${cells[1].trim()}</td>
                                        <td>${cells[2].trim()}</td>
                                        <td>${cells[3].trim()}</td>
                                        <td>${cells[4].trim()}</td>
                                    </tr>
                                `;
                            }
                        });
                        
                        tableHTML += `
                                    </tbody>
                                </table>
                            </div>
                        `;
                        return tableHTML;
                    }
                );
            }
            
            // X·ª≠ l√Ω in ƒë·∫≠m
            let formatted = content.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            
            // X·ª≠ l√Ω xu
